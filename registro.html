<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Registro mensual</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #121212;
  color: #FFA500;
}

.container {
  max-width: 1200px;
  margin: auto;
  padding: 16px;
}

h1, h2 {
  text-align: center;
  margin-bottom: 12px;
}

/* ===== Selector ===== */
.mes-selector {
  display: flex;
  justify-content: center;
  margin-bottom: 20px;
}

select {
  padding: 10px;
  font-size: 16px;
  border-radius: 8px;
  border: none;
}

/* ===== Calendario ===== */
.calendario {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 8px;
  margin-bottom: 30px;
}

.dia-semana {
  text-align: center;
  font-weight: bold;
}

.dia {
  background: #1E1E1E;
  border-radius: 10px;
  padding: 6px;
  min-height: 90px;
  display: flex;
  flex-direction: column;
}

.dia.fin-semana {
  background: #2A2A2A;
}

.numero-dia {
  font-size: 13px;
  text-align: right;
  opacity: 0.7;
}

/* ===== Entrenamientos ===== */
.entrenamientos {
  margin-top: 6px;
  font-size: 13px;
  color: #00FF00;
  display: flex;
  justify-content: center;
}

.entrenamientos .lista-nombres {
  width: 100%;
  text-align: center;
}

.nombre-dia {
  margin-bottom: 4px;
}

/* Desktop */
@media (min-width: 900px) {
  .entrenamientos {
    font-size: 16.8px; /* +20% */
  }

  .entrenamientos .lista-nombres {
    column-count: 2;
    column-gap: 16px;
  }

  .nombre-dia {
    break-inside: avoid;
  }
}

/* ===== Resumen ===== */
.resumen {
  background: #1E1E1E;
  border-radius: 12px;
  padding: 16px;
  margin: 0 auto 24px auto;
  max-width: 420px;
}

table {
  width: 100%;
  border-collapse: collapse;
}

th, td {
  padding: 8px;
  border-bottom: 1px solid #333;
}

th {
  color: #FFB732;
}

td.nombre {
  text-align: left;
}

td.numero {
  text-align: center;
}

/* ===== BotÃ³n ===== */
.volver {
  display: block;
  margin: 0 auto;
  padding: 12px 20px;
  background: #FFA500;
  color: #121212;
  border: none;
  border-radius: 10px;
  font-size: 16px;
  cursor: pointer;
}

.volver:hover {
  background: #FFB732;
}
</style>
</head>

<body>
<div class="container">

<h1 id="tituloMes">ðŸ§ª Enero (prueba)</h1>

<div class="mes-selector">
<select id="selectorMes">
  <option value="0">ðŸ§ª Enero (prueba)</option>
  <option value="1">Febrero</option>
  <option value="2">Marzo</option>
  <option value="3">Abril</option>
  <option value="4">Mayo</option>
  <option value="5">Junio</option>
  <option value="6">Julio</option>
  <option value="7">Agosto</option>
  <option value="8">Septiembre</option>
  <option value="9">Octubre</option>
  <option value="10">Noviembre</option>
</select>
</div>

  <div class="calendario" id="calendario">
  <div class="dia-semana">Dom</div>
  <div class="dia-semana">Lun</div>
  <div class="dia-semana">Mar</div>
  <div class="dia-semana">MiÃ©</div>
  <div class="dia-semana">Jue</div>
  <div class="dia-semana">Vie</div>
  <div class="dia-semana">SÃ¡b</div>
  
</div>

<div class="resumen">
<h2>Resumen del mes</h2>
<table>
<thead>
<tr>
  <th>Nombre</th>
  <th>DÃ­as</th>
  <th>Semanas</th>
</tr>
</thead>
<tbody id="tablaResumen"></tbody>
</table>
</div>

<button class="volver" onclick="window.location='index.html'">
â¬… Volver al menÃº
</button>

</div>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzFl9mIqMbcd6NbPIfkJwyqrKqPKVO1KtiEvyn0e5wRwJejY50f6boivwLlqPlq08lt/exec";
const ANIO = 2026;

const calendario = document.getElementById("calendario");
const selectorMes = document.getElementById("selectorMes");
const tituloMes = document.getElementById("tituloMes");
const tablaResumen = document.getElementById("tablaResumen");

const nombresParticipantes = ["Mati", "Luca", "Litox", "Fran", "Unyi"];

const nombresMeses = [
  "ðŸ§ª Enero (prueba)", "Febrero", "Marzo", "Abril", "Mayo", "Junio",
  "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre"
];

let datos = [];

/* ===== Fetch ===== */
async function fetchDatos() {
  const res = await fetch(WEB_APP_URL);
  datos = await res.json();
  actualizarVista();
}

/* ===== Vista ===== */
function actualizarVista() {
  const mes = Number(selectorMes.value);
  tituloMes.textContent = nombresMeses[mes];
  generarCalendario(mes);
  pintarEntrenamientos(mes);
  generarResumen(mes);
}

/* ===== Calendario ===== */
function generarCalendario(mes) {
  calendario.querySelectorAll(".dia").forEach(d => d.remove());

  const primerDia = new Date(ANIO, mes, 1);
  let inicio = primerDia.getDay(); // 0=domingo, 1=lunes, ..., 6=sÃ¡bado
  const diasMes = new Date(ANIO, mes + 1, 0).getDate();

  for (let i = 0; i < inicio; i++) {
    const v = document.createElement("div");
    v.className = "dia";
    v.style.opacity = "0.2";
    calendario.appendChild(v);
  }

  for (let d = 1; d <= diasMes; d++) {
    const fecha = new Date(ANIO, mes, d);
    const diaSemana = fecha.getDay();

    const celda = document.createElement("div");
    celda.className = "dia";
    if (diaSemana === 0 || diaSemana === 6) celda.classList.add("fin-semana");

    celda.innerHTML = `
      <div class="numero-dia">${d}</div>
      <div class="entrenamientos"></div>
    `;
    calendario.appendChild(celda);
  }
}

/* ===== Pintar entrenamientos ===== */
function pintarEntrenamientos(mes) {
  const mapa = {};

  datos.forEach(r => {
    const [aÃ±o, mesR, diaR] = r.fechaEntrenamiento.split("-").map(Number);
    const f = new Date(aÃ±o, mesR - 1, diaR);
    if (f.getMonth() === mes && f.getFullYear() === ANIO) {
      const d = f.getDate();
      if (!mapa[d]) mapa[d] = [];
      mapa[d].push(r.nombre);
    }
  });

  calendario.querySelectorAll(".dia").forEach(celda => {
    const n = celda.querySelector(".numero-dia");
    if (!n) return;

    const dia = Number(n.textContent);
    const contenedor = celda.querySelector(".entrenamientos");
    contenedor.innerHTML = "";

    if (mapa[dia]) {
      const lista = document.createElement("div");
      lista.className = "lista-nombres";

      mapa[dia].forEach(nombre => {
        const div = document.createElement("div");
        div.className = "nombre-dia";
        div.textContent = nombre;
        lista.appendChild(div);
      });

      contenedor.appendChild(lista);
    }
  });
}

/* ===== Resumen ===== */
function generarResumen(mes) {
  tablaResumen.innerHTML = "";

  const dias = {};
  const semanas = {};

  nombresParticipantes.forEach(n => {
    dias[n] = 0;
    semanas[n] = {};
  });

  datos.forEach(r => {
    const [aÃ±o, mesR, diaR] = r.fechaEntrenamiento.split("-").map(Number);
    const f = new Date(aÃ±o, mesR - 1, diaR);
    if (f.getMonth() !== mes || f.getFullYear() !== ANIO) return;

    dias[r.nombre]++;

    const day = f.getDay(); // domingo=0, lunes=1, ..., sÃ¡bado=6
const lunes = new Date(f);

if(day === 0) {
  // Domingo â†’ retroceder 6 dÃ­as
  lunes.setDate(f.getDate() - 6);
} else {
  // Lunes a sÃ¡bado â†’ retroceder day-1 dÃ­as
  lunes.setDate(f.getDate() - (day - 1));
}

const clave = `${lunes.getFullYear()}-${String(lunes.getMonth()+1).padStart(2,'0')}-${String(lunes.getDate()).padStart(2,'0')}`;

    if (!semanas[r.nombre][clave]) semanas[r.nombre][clave] = new Set();
    semanas[r.nombre][clave].add(f.getDate());
  });

  nombresParticipantes.forEach(n => {
    let completas = 0;
    Object.values(semanas[n]).forEach(s => {
      if (s.size >= 3) completas++;
    });

    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td class="nombre">${n}</td>
      <td class="numero">${dias[n]}</td>
      <td class="numero">${completas}</td>
    `;
    tablaResumen.appendChild(tr);
  });
}

selectorMes.addEventListener("change", actualizarVista);
fetchDatos();
</script>
</body>
</html>
