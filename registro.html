<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Registro mensual</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #121212;
  color: #FFA500;
}

.container {
  max-width: 1200px;
  margin: auto;
  padding: 16px;
}

h1, h2 {
  text-align: center;
  margin-bottom: 12px;
}

.mes-selector {
  display: flex;
  justify-content: center;
  margin-bottom: 20px;
}

select {
  padding: 10px;
  font-size: 16px;
  border-radius: 8px;
  border: none;
}

.calendario {
  display: grid;
  grid-template-columns: repeat(7, 1fr);
  gap: 8px;
  margin-bottom: 30px;
}

.dia-semana {
  text-align: center;
  font-weight: bold;
}

.dia {
  background: #1E1E1E;
  border-radius: 10px;
  padding: 6px;
  min-height: 90px;
  display: flex;
  flex-direction: column;
}

.dia.fin-semana {
  background: #2A2A2A;
}

.numero-dia {
  font-size: 13px;
  text-align: right;
  opacity: 0.7;
}

.entrenamientos {
  font-size: 13px;
  margin-top: 6px;
  color: #00FF00;
}

.resumen {
  background: #1E1E1E;
  border-radius: 12px;
  padding: 16px;
  margin-bottom: 20px;
}

table {
  width: 100%;
  border-collapse: collapse;
}

th, td {
  padding: 10px;
  border-bottom: 1px solid #333;
}

th {
  color: #FFB732;
}

.volver {
  display: block;
  margin: 0 auto;
  padding: 12px 20px;
  background: #FFA500;
  color: #121212;
  border: none;
  border-radius: 12px;
  font-size: 16px;
  cursor: pointer;
}

.volver:hover {
  background: #FFB732;
}

@media (max-width: 768px) {
  .dia {
    min-height: 70px;
  }
}
</style>
</head>

<body>
<div class="container">

<h1 id="tituloMes">üß™ Enero (prueba)</h1>

<div class="mes-selector">
  <select id="selectorMes">
    <option value="0">üß™ Enero (prueba)</option>
    <option value="1">Febrero</option>
    <option value="2">Marzo</option>
    <option value="3">Abril</option>
    <option value="4">Mayo</option>
    <option value="5">Junio</option>
    <option value="6">Julio</option>
    <option value="7">Agosto</option>
    <option value="8">Septiembre</option>
    <option value="9">Octubre</option>
    <option value="10">Noviembre</option>
  </select>
</div>

<div class="calendario" id="calendario">
  <div class="dia-semana">Lun</div>
  <div class="dia-semana">Mar</div>
  <div class="dia-semana">Mi√©</div>
  <div class="dia-semana">Jue</div>
  <div class="dia-semana">Vie</div>
  <div class="dia-semana">S√°b</div>
  <div class="dia-semana">Dom</div>
</div>

<div class="resumen">
  <h2>Resumen del mes</h2>
  <table>
    <thead>
      <tr>
        <th>Nombre</th>
        <th>D√≠as entrenados</th>
      </tr>
    </thead>
    <tbody id="tablaResumen"></tbody>
  </table>
</div>

<button class="volver" onclick="window.location='index.html'">
  ‚¨Ö Volver al men√∫
</button>

</div>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzFl9mIqMbcd6NbPIfkJwyqrKqPKVO1KtiEvyn0e5wRwJejY50f6boivwLlqPlq08lt/exec";
const ANIO = 2026;

const calendario = document.getElementById("calendario");
const selectorMes = document.getElementById("selectorMes");
const tituloMes = document.getElementById("tituloMes");
const tablaResumen = document.getElementById("tablaResumen");

const nombresMeses = [
  "üß™ Enero (prueba)", "Febrero", "Marzo", "Abril", "Mayo",
  "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre"
];

const participantes = ["Mati", "Luca", "Litox", "Fran", "Unyi"];
let datos = [];

function parseFechaISO(str) {
  const [y, m, d] = str.split("-");
  return new Date(y, m - 1, d);
}

async function fetchDatos() {
  const res = await fetch(WEB_APP_URL);
  datos = await res.json();
  actualizarVista();
}

function generarCalendario(mes) {
  calendario.querySelectorAll(".dia").forEach(d => d.remove());
  tituloMes.textContent = nombresMeses[mes];

  const primerDia = new Date(ANIO, mes, 1);
  let inicio = primerDia.getDay();
  inicio = inicio === 0 ? 6 : inicio - 1;

  const diasMes = new Date(ANIO, mes + 1, 0).getDate();

  for (let i = 0; i < inicio; i++) {
    const v = document.createElement("div");
    v.className = "dia";
    v.style.opacity = "0.2";
    calendario.appendChild(v);
  }

  for (let d = 1; d <= diasMes; d++) {
    const fecha = new Date(ANIO, mes, d);
    const celda = document.createElement("div");
    celda.className = "dia";

    if (fecha.getDay() === 0 || fecha.getDay() === 6) {
      celda.classList.add("fin-semana");
    }

    celda.innerHTML = `
      <div class="numero-dia">${d}</div>
      <div class="entrenamientos"></div>
    `;
    calendario.appendChild(celda);
  }
}

function pintarEntrenamientos(mes) {
  const mapa = {};

  datos.forEach(r => {
    const f = parseFechaISO(r.fechaEntrenamiento);
    if (f.getFullYear() === ANIO && f.getMonth() === mes) {
      const d = f.getDate();
      if (!mapa[d]) mapa[d] = [];
      mapa[d].push(r.nombre);
    }
  });

  calendario.querySelectorAll(".dia").forEach(celda => {
    const n = celda.querySelector(".numero-dia");
    if (!n) return;
    const d = Number(n.textContent);
    if (mapa[d]) {
      celda.querySelector(".entrenamientos").innerHTML =
        mapa[d].map(n => `‚óè ${n}`).join("<br>");
    }
  });
}

function generarResumen(mes) {
  tablaResumen.innerHTML = "";
  const resumen = {};
  participantes.forEach(p => resumen[p] = 0);

  datos.forEach(r => {
    const f = parseFechaISO(r.fechaEntrenamiento);
    if (f.getFullYear() === ANIO && f.getMonth() === mes) {
      if (resumen[r.nombre] !== undefined) resumen[r.nombre]++;
    }
  });

  participantes.forEach(p => {
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${p}</td><td>${resumen[p]}</td>`;
    tablaResumen.appendChild(tr);
  });
}

function actualizarVista() {
  const mes = Number(selectorMes.value);
  generarCalendario(mes);
  pintarEntrenamientos(mes);
  generarResumen(mes);
}

selectorMes.addEventListener("change", actualizarVista);
fetchDatos();
</script>

</body>
</html>
